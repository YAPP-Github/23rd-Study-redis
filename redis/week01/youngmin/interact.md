## Programmability

- 사용자가 서버에서 직접 사용자 정의 스크립트를 실행할 수 있는 프로그래밍 인터페이스를 제공
  - 7.0 버전부터는 Redis Functions를 사용하여 스크립트를 관리하고 실행
  - 6.2 이하 버전에서는 EVAL 명령어를 사용하여 Lua 스크립트를 이용
- Programmability 기능은 서버에서 임의의 사용자 정의 로직을 실행할 수 있게 해주며, 이를 통해 데이터 처리를 데이터가 위치한 곳(서버)에서 직접 수행할 수 있음
  - 이러한 기능은 네트워크 트래픽을 줄이고 성능을 개선하는 데 도움이 됨
- Lua 5.1 인터프리터를 사용하는 샌드박스형 스크립트 엔진을 내장하고 있음
  - 스크립트 실행은 레디스 서버의 모든 활동을 차단하는 원자적(Atomic) 실행을 보장
  - 스크립트가 실행되는 동안 다른 클라이언트의 명령은 차단
- 읽기 전용 스크립트
  - 레디스 내의 키를 수정하지 않는 명령만 실행할 수 있음
  - 복제본에서도 실행 가능하며, 메모리 한계를 초과할 때 실패하지 않음
- Redis는 사용자 스크립트를 샌드박스 내에서 실행하여 서버 환경의 잠재적 위험을 최소화
- 스크립트는 기본적으로 최대 5초 동안 실행될 수 있음. 이 시간은 일반적으로 스크립트가 실행되는데 충분하지만, 스크립트가 예상치 못한 무한 루프에 빠졌을 경우를 대비한 것.
  - 설정된 시간 초과 시, 스크립트는 자동으로 종료되지 않지만, 읽기 전용 명령만 실행하는 스크립트는 `SCRIPT KILL`이나 `FUNCTION KILL`` 명령으로 종료할 수 있음

## Transaction

- 트랜잭션은 여러 명령어를 하나의 단계로 실행할 수 있게 해줌
- `MULTI`, `EXEC`, `DISCARD`, `WATCH` 명령어를 중심으로 작동
- 트랜잭션 내의 모든 명령어는 순차적으로 직렬화되어 실행
  - 다른 클라이언트의 요청은 트랜잭션 실행 중간에 처리되지 않아 단일 분리된 작업으로 실행
- `EXEC` 명령어는 트랜잭션 내의 모든 명령어를 실행
  - 클라이언트가 `EXEC` 명령어 호출 전에 연결이 끊어지면 아무 작업도 수행되지 않음
  - EXEC가 호출되면 모든 작업 수행
- 트랜잭션 사용
  - `MULTI` 명령어로 트랜잭션을 시작
  - 이후 여러 명령어를 입력할 수 있으며, 이들은 `EXEC`가 호출될 때까지 대기열에 들어감
  - `DISCARD` 명령어는 트랜잭션 대기열을 비우고 트랜잭션을 종료
- 트랜잭션 중에 명령어가 대기열에 추가되지 않거나, EXEC 호출 후 명령어가 실패할 수 있음
  - Redis 2.6.5부터는 `EXEC` 중 오류가 발생하면 트랜잭션이 거부되고 취소됨
- Redis는 성능과 단순성 때문에 트랜잭션의 롤백을 지원하지 않음
- 낙관적 잠금
  - `WATCH` 명령어는 낙관적 잠금(CAS 비슷한 동작)을 제공합니다. `WATCH`된 키가 `EXEC` 명령어 실행 전에 변경되면 트랜잭션이 중단되고 실패
- 레디스 스크립트는 트랜잭션과 같은 방식으로 작동하며, 보통 더 간단하고 빠름

## Pub/Sub

- 발행자(publishers)와 구독자(subscribers) 사이의 메시지 전달을 위한 메커니즘
  - 발행자는 특정 수신자에게 메시지를 보내도록 프로그래밍되지 않으며, 대신 발행된 메시지들은 채널별로 구분
  - 구독자는 하나 이상의 채널에 관심을 표시하고 관심 있는 메시지만 받게 됨
- 사용법
  - `SUBSCRIBE` 명령어를 사용하여 하나 이상의 채널에 구독
  - `PUBLISH` 명령어로 메시지를 해당 채널에 발행하면, 모든 구독자에게 메시지가 전송
  - 구독 중인 클라이언트는 `SUBSCRIBE` 및 `UNSUBSCRIBE` 명령어 외에는 다른 명령을 내릴 수 없음
- Pub/Sub은 최대 한 번(at-most-once) 메시지 Delivery semantics을 제공
  - 메시지가 발송되면 다시 전송되지 않음 (구독자가 메시지를 처리할 수 없는 경우 메시지는 영구적으로 손실)
  - 더 강력한 배달 보장이 필요한 경우, [Stream](#Stream)을 사용하는 것이 좋음
- 메시지 형식
  - 메시지는 세 가지 요소를 가진 배열 응답 형태로 전송 (메시지 타입, 채널 이름, 메시지 페이로드)
- 패턴 매칭 구독
  - 레디스 Pub/Sub은 글로브 스타일 패턴을 사용하여 패턴에 일치하는 모든 채널로부터 메시지를 수신할 수 있게 함
  - 예를 들어, "news.\*"에 대해 PSUBSCRIBE 하면 "news.art.figurative", "news.music.jazz" 등의 채널로부터 메시지를 받을 수 있음
- 채널 스코핑과 데이터베이스
  - Pub/Sub은 키 공간과 관련이 없으며, 다른 데이터베이스 번호를 가진 구독자도 메시지를 수신할 수 있음
- 샤딩
  - Redis 7.0부터는 샤딩 Pub/Sub이 도입되어 클러스터 모드에서 Pub/Sub의 사용을 확장할 수 있음
  - `SSUBSCRIBE`, `SUNSUBSCRIBE`, `SPUBLISH` 명령어를 사용하여 구현
